import{Aa as o,W as d,a as c,b as h,d as S,e as k,f as i,i as f,k as p,wa as b}from"./chunk-YTAQRA7X.js";var U=(()=>{let s=class s{constructor(e,t){this.router=e,this.http=t,this.userSubject=new S(JSON.parse(localStorage.getItem("user"))),this.user=this.userSubject.asObservable()}get userValue(){return this.userSubject.value}handleErrorObservable(e){console.error(e.message||e),k(()=>new Error(e.message))}xxlogin(e,t){return this.http.get(`${o.apiUrl}/login?username=${e}&password=${t}`).pipe(i(r=>(localStorage.setItem("user",JSON.stringify(r)),this.userSubject.next(r),r)))}getToken(e,t){return h(this,null,function*(){console.log("inside get token",e,t);let r=new FormData;r.append("username",e),r.append("password",t),localStorage.removeItem("token"),yield this.http.post(`${o.apiUrl}/token`,r).subscribe(n=>{console.log(n),n.access_token&&localStorage.setItem("token",n.access_token)})})}login(e,t){this.userToken=localStorage.getItem("token"),this.userToken||(this.getToken(e,t),this.userToken=localStorage.getItem("token")),console.log("inside login, token:",this.userToken),console.log("inside login:",e,t),console.log("calling users/me",`${o.apiUrl}/users/me`);let r=new FormData;return r.append("username",e),r.append("password",t),localStorage.removeItem("token"),localStorage.removeItem("user"),this.http.post(`${o.apiUrl}/token`,r).pipe(i(n=>{console.log("res=",n);let u=JSON.stringify(n);console.log("rslt=",u);let g=JSON.parse(u);console.log("rslt",u);let a=JSON.stringify(g.user),m=g.access_token;return console.log("usr/token",a,m),localStorage.setItem("token",m),localStorage.setItem("user",a),this.userSubject.next(JSON.parse(a)),a}))}logout(){localStorage.removeItem("user"),localStorage.removeItem("token"),this.userSubject.next(null),this.router.navigate(["/account/login"])}register(e){return this.http.post(`${o.apiUrl}/users/register`,e,{responseType:"text"})}getAll(){return this.http.get(`${o.apiUrl}/users`)}getById(e){return this.http.get(`${o.apiUrl}/users/get_user?username=${e}`)}update(e){return this.http.post(`${o.apiUrl}/users/update`,e).pipe(i(t=>{if(e.username==this.userValue?.username){let r=c(c({},this.userValue),e);localStorage.setItem("user",JSON.stringify(r)),this.userSubject.next(r)}return t}))}delete(e){return console.log("in accounbt service delete user"),this.http.delete(`${o.apiUrl}/users/delete_user?username=${e}`).pipe(i(t=>(e==this.userValue?.username&&this.logout(),t)))}};s.\u0275fac=function(t){return new(t||s)(p(b),p(d))},s.\u0275prov=f({token:s,factory:s.\u0275fac,providedIn:"root"});let l=s;return l})();export{U as a};
